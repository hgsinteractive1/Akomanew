<style type="text/css">
    b {font-weight: bold;}
    i {font-style: italic;}
</style>


<!--BEGIN STORY DETAIL -->
<div id="story-detail">
    <!--STORY INTRO AREA-->
    <div id="story-intro">
        <div class="edit-icon"></div>

        <!--REMOVE not-edited-yet class when user starts editing-->
        <!--This will remove the default grey-->
        <h2>
            {{gh-trim-focus-input type="hidden" id="entry-title" value=model.titleScratch}}
            {{#if model.titleScratch}}
                <div class="editable-wrapper" contenteditable="true" id="entry-title-visible">{{model.titleScratch}}</div>
            {{else}}
                <div class="editable-wrapper not-edited-yet" contenteditable="true" id="entry-title-visible">Enter Story Title...</div>
            {{/if}}
        </h2>
    </div>
    <!--END STORY INTRO AREA-->

    <!--BEGIN STORY IMAGE-->
    <div id="story-image">
        {{gh-uploader uploaded="setCoverImage" canceled="clearCoverImage" description="Add post image" image=model.image uploaderReference=uploaderReference tagName="section"}}

        {{!-- <!--
        <img src="images/placeholder_story_image.jpg">
        -->
        <div id="upload-container"></div> --}}
    </div>
    <!--END STORY IMAGE-->
    <!--BEGIN STORY BODY-->
    <div id="story-body">
        <div class="edit-icon"></div>
       {{#if model.scratch}}
        <div class="editable-wrapper " contenteditable="true">
            <section class="entry-markdown js-entry-markdown {{unless isPreview 'active'}}">
                <section id="entry-markdown-content" class="entry-markdown-content">
                    {{gh-ed-editor classNames="markdown-editor js-markdown-editor" tabindex="1" spellcheck="true" value=model.scratch
                    scrollInfo=view.editorScrollInfo focus=shouldFocusEditor focusCursorAtEnd=model.isDirty
                    setEditor="setEditor" openModal="openModal" onFocusIn="autoSaveNew"}}
                </section>
            </section>
        </div>
       {{else}}
       <div class="editable-wrapper not-edited-yet" contenteditable="true">
            <section class="entry-markdown js-entry-markdown {{unless isPreview 'active'}}">
                <section id="entry-markdown-content" class="entry-markdown-content">
                    {{gh-ed-editor classNames="markdown-editor js-markdown-editor" tabindex="1" spellcheck="true" value=model.scratch
                    scrollInfo=view.editorScrollInfo focus=shouldFocusEditor focusCursorAtEnd=model.isDirty
                    setEditor="setEditor" openModal="openModal" onFocusIn="autoSaveNew"}}
                </section>
            </section>
        </div>
       {{/if}}
    </div>
    <!--END STORY BODY-->
</div>
<!--END STORY DETAIL-->



<div id="finish-overlay">
    <div class="relative">
        <div id="content">
            
            <!--TOP DIRECTIONS-->
            <div id="top-directions">
                <h4>Done Editing?</h4>
                <p>Change your storyâ€™s title, subtitle and add relevant tags.</p>
            </div>
            <!--END TOP DIRECTIONS-->
            <!--BEGIN SUMMARY DETAILS-->
            <div id="summary-details">
                <div class="story-info">
                    <h4 class='summary-title'>{{model.title}}</h4>
                    <hr/ >
                    <div class="summary">
                        {{gh-input name="post-setting-abstract" type="hidden" id="entity-abstract" value=model.abstract action="setAbstract"}}
                        <div contenteditable="true" id='abstract-editor'>
                            {{{gh-excerpt model.abstractScratch model.copy}}}
                        </div>
                        <div class="edit-icon"></div>
                    </div>
                    {{render 'post-tags-input'}}
                    <div class="clear"></div>
                    <p class="tag-descrip">Stories may have multiple tags</p>
                </div>
            </div>
            <!--END SUMMARY DETAILS-->
            <!--BEGIN ACTION AREA/BUTTONS -->
            <div id="action-area">
                <ul class="action-list">
                    <li><a href="#" class="action-button continue-editing">Continue Editing<div class="continue-editing-icon"></div></a></li>
                    {{view "editor-save-button" id="entry-actions" classNameBindings="model.isNew:unsaved"}}
                </ul>
            </div>
            <!--END ACTION AREA-->
        </div>
    </div>
</div>


<!-- TODO: Remove this. -->
<script type="text/javascript">
    // If they edit the abstract, create an input (if there isnt already one) to store it in so that we save the abstract value.
    $("#abstract-editor").on("keyup", function(){
        var input = $("input#entity-abstract", $(this).closest(".summary"));
        input.val($("#abstract-editor").html());
        input.change();
    });

    // Remove the "not-edited-yet" class when edits are made to divs.
    $("[contenteditable=true]").on("keyup", function(){ 
        $(this).closest(".not-edited-yet").removeClass("not-edited-yet"); 
    });

    // Update a hidden input with the changes made to the editable div.
    // This is so the header text saves correctly.
    $("#story-intro h2").on("keyup", "#entry-title-visible", function(){ $("#entry-title").val($(this).text()); $("#entry-title").change(); });
    // $("#entry-title").on("change", function(){ $("#entry-title-visible").html($(this).val()); });

    // Bind the finish editing button, this should show the modal
    $("#finish-writing-story").on("click", function(e){
        e.preventDefault();
        
        // Copy the title
        $(".summary-title").html($("#entry-title").val());

        $("#finish-overlay").fadeIn("fast");
    });

    // Bind the continue editing button, this just dismisses the modal.
    $("#finish-overlay #action-area .continue-editing").on("click", function(e){
        e.preventDefault();
        $("#finish-overlay").fadeOut("fast");
    });

</script>




{{!-- <header class="page-header">
    <button class="menu-button js-menu-button" {{action "toggleGlobalMobileNav"}}><span class="sr-only">Menu</span></button>
    <h2 class="page-title">Editor</h2>
</header>
 --}}
{{!-- <div class="page-content">
    <header>
        <section class="box entry-title">
            {{gh-trim-focus-input type="text" id="entry-title" placeholder="Your Post Title" value=model.titleScratch
            tabindex="1" focus=shouldFocusTitle}}
        </section>
    </header>
    

    <div class="settings-menu-content">
    {{gh-uploader uploaded="setCoverImage" canceled="clearCoverImage" description="Add post image" image=model.image uploaderReference=uploaderReference tagName="section"}}
    </div>

    <section class="entry-markdown js-entry-markdown {{unless isPreview 'active'}}">
        <section id="entry-markdown-content" class="entry-markdown-content">
            {{gh-ed-editor classNames="markdown-editor js-markdown-editor" tabindex="1" spellcheck="true" value=model.scratch
            scrollInfo=view.editorScrollInfo focus=shouldFocusEditor focusCursorAtEnd=model.isDirty
            setEditor="setEditor" openModal="openModal" onFocusIn="autoSaveNew"}}
        </section>
    </section>

    {{partial "publish-bar"}}

</div>
 --}}

