<!--BEGIN STORY DETAIL -->
<div id="story-detail">
    <!--STORY INTRO AREA-->
    <div id="story-intro" class="editor-placeholder-wrapper">
        <div class="edit-icon"></div>
        {{gh-trim-focus-input type="hidden" id="entry-title" value=model.titleScratch}}

        <!--REMOVE not-edited-yet class when user starts editing-->
        <!--This will remove the default grey-->
        <h2>
            {{#if model.titleScratch}}
                <div contenteditable="true" id="entry-title-visible">{{model.titleScratch}}</div>
            {{else}}
                <div contenteditable="true" id="entry-title-visible"></div>
            {{/if}}
            <div class='editor-placeholder {{if model.titleScratch "hidden" ""}}'>Enter Story Title...</div>
        </h2>
    </div>
    <!--END STORY INTRO AREA-->

    <!--BEGIN STORY IMAGE-->
    <div id="story-image">
        {{gh-uploader uploaded="setCoverImage" canceled="clearCoverImage" description="Add post image" image=model.image uploaderReference=uploaderReference tagName="section"}}
    </div>
    <!--END STORY IMAGE-->
    <!--BEGIN STORY BODY-->
    <div id="story-body" class="editor-placeholder-wrapper">
        <div class="edit-icon"></div>
        {{gh-ed-editor classNames="markdown-editor js-markdown-editor" tabindex="1" spellcheck="true" value=model.scratch
        scrollInfo=view.editorScrollInfo focus=shouldFocusEditor focusCursorAtEnd=model.isDirty
        setEditor="setEditor" openModal="openModal" onFocusIn="autoSaveNew"}}
    </div>
    <!--END STORY BODY-->
</div>
<!--END STORY DETAIL-->



<div id="finish-overlay">
    <div class="relative">
        <div id="content">
            
            <!--TOP DIRECTIONS-->
            <div id="top-directions">
                <h4>Done Editing?</h4>
                <p>Change your storyâ€™s title, subtitle and add relevant tags.</p>
            </div>
            <!--END TOP DIRECTIONS-->
            <!--BEGIN SUMMARY DETAILS-->
            <div id="summary-details">
                <div class="story-info">
                    <h4 class='summary-title'>{{model.title}}</h4>
                    <hr/ >
                    <div class="summary">
                        {{gh-input name="post-setting-abstract" type="hidden" id="entity-abstract" value=model.abstract action="setAbstract"}}
                        <div contenteditable="true" id='abstract-editor'>
                            {{{gh-excerpt model.abstractScratch model.copy}}}
                        </div>
                        <div class="edit-icon"></div>
                    </div>
                    {{render 'post-tags-input'}}
                    <div class="clear"></div>
                    <p class="tag-descrip">Stories may have multiple tags</p>
                </div>
            </div>
            <!--END SUMMARY DETAILS-->
            <!--BEGIN ACTION AREA/BUTTONS -->
            <div id="action-area">
                <ul class="action-list">
                    <li><a href="#" class="action-button continue-editing">Continue Editing<div class="continue-editing-icon"></div></a></li>
                    {{view "editor-save-button" id="entry-actions" classNameBindings="model.isNew:unsaved"}}
                </ul>
            </div>
            <!--END ACTION AREA-->
        </div>
    </div>
</div>


<!-- TODO: Remove this. -->
<script type="text/javascript">
    // If they edit the abstract, create an input (if there isnt already one) to store it in so that we save the abstract value.
    $("#abstract-editor").on("keyup", function(){
        var input = $("input#entity-abstract", $(this).closest(".summary"));
        input.val($("#abstract-editor").html());
        input.change();
    });

    $("#story-detail").on("focus", "[contenteditable=true]", function(){
        $(".editor-placeholder", $(this).closest(".editor-placeholder-wrapper")).addClass("hidden");
    });

    $("#story-detail").on("blur", "[contenteditable=true]", function(){ 
        if($(this).text().trim().length === 0){
            $(".editor-placeholder", $(this).closest(".editor-placeholder-wrapper")).removeClass("hidden");
        }
    });

    $(".edit-icon").on("click", function(){
        $("[contenteditable=true]", $(this).closest(".editor-placeholder-wrapper")).focus();
    });

    // Update a hidden input with the changes made to the editable div.
    // This is so the header text saves correctly.
    $("#story-intro h2").on("blur", "#entry-title-visible", function(){ 
        $("#entry-title").val($(this).text());
        $("#entry-title").change();
    });

    // Bind the finish editing button, this should show the modal
    $("#finish-writing-story").on("click", function(e){
        e.preventDefault();
        
        // Copy the title
        $(".summary-title").html($("#entry-title").val());

        $("#finish-overlay").fadeIn("fast");
    });

    // Bind the continue editing button, this just dismisses the modal.
    $("#finish-overlay #action-area .continue-editing").on("click", function(e){
        e.preventDefault();
        $("#finish-overlay").fadeOut("fast");
    });

    grande.bind($("#body-editor .content"));
</script>

