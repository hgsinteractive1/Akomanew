(function(){function e(){var e=P.createElement("div"),n="<div class='options'>           <span class='no-overflow'>             <span class='ui-inputs'>               <button class='bold'>B</button>               <button class='italic'>i</button>               <button class='header2'>h</button>                <button class='quote'>&rdquo;</button>               <button class='url useicons'>link</button>               <input class='url-input' type='text' placeholder='Paste or type a link'/>             </span>           </span>         </div>",t=P.createElement("div"),o=P.createElement("div");o.className="g-body",P.body.appendChild(o),t.innerHTML="<div class='pos-abs file-label'>Insert image</div>                                         <input class='file-hidden pos-abs' type='file' id='files' name='files[]' accept='image/*' multiple/>",t.className="image-tooltip hide",e.className="text-menu hide",e.innerHTML=n,0===P.querySelectorAll(".text-menu").length&&(o.appendChild(e),o.appendChild(t)),I=P.querySelectorAll(".file-label + input")[0],M=P.querySelectorAll(".image-tooltip")[0],A=P.querySelectorAll(".text-menu")[0],T=P.querySelectorAll(".text-menu .options")[0],q=P.querySelectorAll(".text-menu .url-input")[0]}function n(){var e,n,i;for(P.onmouseup=function(e){setTimeout(function(){L(e)},1)},P.onkeydown=d,P.onkeyup=function(e){var n=window.getSelection();n.anchorNode&&"ARTICLE"!==n.anchorNode.nodeName&&(m(e),n.isCollapsed&&h(e))},H.onresize=L,q.onblur=b,q.onkeydown=C,_.allowImages&&(M.onmousedown=o,I.onchange=a,P.onmousemove=t),e=0,n=Y.length;n>e;e++)i=Y[e],i.contentEditable=!0,i.onkeyup=i.onmouseup=L}function t(e){i(e,e.target)}function o(e){var n=U.children,t=U.getBoundingClientRect();O=r(n,t,e)}function a(e){var n,t=this.files[0],o=new FileReader;o.onload=function(e){return function(e){n=P.createElement("figure"),n.innerHTML='<img src="'+e.target.result+'"/>',U.insertBefore(n,O.bottomElement)}}(t),o.readAsDataURL(t)}function i(e,n){var t=U.children,o=U.getBoundingClientRect(),a=r(t,o,e);a?(M.style.left=o.left-90+"px",M.style.top=a.top-17+"px"):(M.style.left=D+"px",M.style.top=D+"px")}function r(e,n,t){var o,a,i,r,l,c,u,s,d=[];for(a=0,i=e.length-1;i>a;a++)r=e[a],l=e[a+1]||null,c=r.getBoundingClientRect().bottom-5,u=l.getBoundingClientRect().top,d.push({top:u,bottom:c,topElement:r,bottomElement:l,index:a+1});for(s=t.pageY-H.scrollY,a=0,i=d.length;i>a;a++)if(o=d[a],s<o.top&&s>o.bottom)return o;return null}function l(e){var n,t,o,a=P.querySelectorAll(".text-menu button"),i=function(n){e(n)};for(n=0,t=a.length;t>n;n++)o=a[n],i(o)}function c(){l(function(e){e.onmousedown=function(n){N(e)}})}function u(){return H.getSelection().focusNode}function s(){var e,n,t,o=u();l(function(a){e=a.className;for(var i in tagClassMap)if(n=tagClassMap[i],t=new RegExp(n),t.test(e)){E(o,i)?a.className=n+" active":a.className=n;break}})}function d(e){var n,t=window.getSelection(),o=S(t.anchorNode,"p");13===e.keyCode&&o&&(prevSibling=o.previousSibling,n=prevSibling&&"HR"===prevSibling.nodeName&&!o.textContent.length,n&&e.preventDefault())}function m(e){var n,t=window.getSelection();13===e.keyCode&&("DIV"===t.anchorNode.nodeName&&x("p"),n=S(t.anchorNode,"p"),n&&f(n))}function f(e){var n,t,o;for(n=e.previousSibling,t=n;t&&t.nodeType==Node.TEXT_NODE;)t=t.previousSibling;"P"!==n.nodeName||n.textContent.length||"HR"===t.nodeName||(o=P.createElement("hr"),o.contentEditable=!1,e.parentNode.replaceChild(o,n))}function p(e){var n;return n=e.nodeType===Node.TEXT_NODE?"data":X?"textContent":"innerText"}function g(e,n,t){var o="ol"===t?"insertOrderedList":"insertUnorderedList",a="ol"===t?3:2;return P.execCommand(o),e.anchorNode[n]=e.anchorNode[n].substring(a),S(e.anchorNode,t)}function h(e){var n,t,o,a,i,r,l=window.getSelection();l.isCollapsed&&l.anchorNode&&"ARTICLE"!==l.anchorNode.nodeName&&(n=p(l.anchorNode),t=l.anchorNode[n],t.match(/^[-*]\s/)&&"LI"!==l.anchorNode.parentNode.nodeName&&(o=g(l,n,"ul")),t.match(/^1\.\s/)&&"LI"!==l.anchorNode.parentNode.nodeName&&(o=g(l,n,"ol")),a=o&&["ul","ol"].indexOf(o.nodeName.toLocaleLowerCase())>=0&&["p","div"].indexOf(o.parentNode.nodeName.toLocaleLowerCase())>=0,a&&(i=l.anchorNode,r=o.parentNode,r.parentNode.insertBefore(o,r),r.parentNode.removeChild(r),v(l,i)))}function v(e,n){range=P.createRange(),range.setStart(n,0),range.setEnd(n,0),e.removeAllRanges(),e.addRange(range)}function N(e){var n,t,o=e.className,a=window.getSelection(),i=a.anchorNode;for(var r in tagClassMap)if(n=tagClassMap[r],t=new RegExp(n),t.test(o))switch(r){case"b":return void(!i||E(i,"h1")||E(i,"h2")||P.execCommand(n,!1));case"i":return void P.execCommand(n,!1);case"h1":case"h2":case"h3":case"blockquote":return void x(r);case"a":return y(),void(T.className="options url-mode")}L()}function b(e){var n=q.value;return T.className="options",window.getSelection().addRange(B),P.execCommand("unlink",!1),""===n?!1:(n.match("^(http://|https://|mailto:)")||(n="http://"+n),P.execCommand("createLink",!1,n),void(q.value=""))}function C(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),q.blur())}function x(e){E(u(),e)?(P.execCommand("formatBlock",!1,"p"),P.execCommand("outdent")):P.execCommand("formatBlock",!1,e)}function y(){setTimeout(function(){var e=R(u());"undefined"!=typeof e?q.value=e:P.execCommand("createLink",!1,"/"),B=window.getSelection().getRangeAt(0),q.focus()},150)}function w(e,n,t){if(null!==e)for(;e.parentNode;){if(n(e))return t(e);e=e.parentNode}}function S(e,n){var t=function(e){return e.nodeName.toLowerCase()===n},o=function(e){return e};return w(e,t,o)}function E(e,n){return!!S(e,n)}function R(e){var n=function(e){return"undefined"!=typeof e.href},t=function(e){return e.href};return w(e,n,t)}function L(e){var n,t,o=H.getSelection(),a=e.target||e.srcElement;return a.isContentEditable&&0!==$(a).closest(".content").length||0!==$(a).closest(".text-menu.active").length?void(o.isCollapsed?(k(D,D),A.className="text-menu hide"):(n=o.getRangeAt(0),t=n.getBoundingClientRect(),s(),k(t.top-5+H.pageYOffset,(t.left+t.right)/2))):(s(),k(D,D),void(A.className="text-menu hide"))}function k(e,n){A.style.top=e+"px",A.style.left=n+"px",_.animate&&(e===D?A.className="text-menu hide":A.className="text-menu active")}var A,T,q,B,M,I,O,D=-999,H=this,P=this.document,Y=P.querySelectorAll(".g-body article"),U=Y[0],X=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,_={animate:!0};grande={bind:function(t,o){t&&(Y=t),_=o||_,e(),n(),c()},select:function(){L()}},tagClassMap={b:"bold",i:"italic",h1:"header1",h2:"header2",a:"url",blockquote:"quote"},H.grande=grande}).call(this);